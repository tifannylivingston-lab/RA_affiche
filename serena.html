<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Serena Williams ‚Äì RA Fun Palmar√®s</title>

<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

<style>
body {
  margin: 0;
  overflow: hidden;
  background: black;
  font-family: Arial, Helvetica, sans-serif;
}
</style>
</head>

<body>

<a-scene
  mindar-image="imageTargetSrc: serena.mind;"
  vr-mode-ui="enabled:false"
  device-orientation-permission-ui="enabled:true">

  <a-camera look-controls="false"></a-camera>

  <a-assets>
    <video id="video-serena" src="serena.mp4" preload="auto" playsinline muted></video>
  </a-assets>

  <a-entity id="target" mindar-image-target="targetIndex:0">

    <!-- VIDEO -->
    <a-plane id="videoPlane"
      material="shader: flat; src: #video-serena"
      visible="false">
    </a-plane>

    <!-- PALMARES FUN -->
    <a-entity id="funPalmares" visible="false">

      <!-- Ballon Tennis -->
      <a-entity id="tennis" position="-1 0 0" scale="0 0 0">
        <a-text value="üéæ" position="0 0.25 0.02" align="center" width="2.5"></a-text>
        <a-text value="23 GC" position="0 -0.2 0.02" align="center" width="2" color="#FF4FD8"></a-text>
      </a-entity>

      <!-- M√©daille -->
      <a-entity id="medal" position="0 0 0" scale="0 0 0">
        <a-text value="ü•á" position="0 0.25 0.02" align="center" width="2.5"></a-text>
        <a-text value="4 OR" position="0 -0.2 0.02" align="center" width="2" color="#FFD700"></a-text>
      </a-entity>

      <!-- Troph√©e -->
      <a-entity id="trophy" position="1 0 0" scale="0 0 0">
        <a-text value="üèÜ" position="0 0.25 0.02" align="center" width="2.5"></a-text>
        <a-text value="319 sem. N¬∞1" position="0 -0.2 0.02" align="center" width="2" color="#FF4FD8"></a-text>
      </a-entity>

      <!-- Confettis -->
      <a-entity id="confettis"></a-entity>

    </a-entity>

  </a-entity>
</a-scene>

<script>
const video = document.querySelector('#video-serena');
const videoPlane = document.querySelector('#videoPlane');
const funPalmares = document.querySelector('#funPalmares');
const tennis = document.querySelector('#tennis');
const medal = document.querySelector('#medal');
const trophy = document.querySelector('#trophy');
const confettis = document.querySelector('#confettis');
const target = document.querySelector('#target');

video.addEventListener('loadedmetadata', () => {
  const r = video.videoWidth / video.videoHeight;
  const h = 1.6;
  videoPlane.setAttribute('geometry', `primitive: plane; width:${h*r}; height:${h}`);
});

// Animation "pop" simple
function animatePop(entity, delay) {
  entity.setAttribute('animation__scale', 
    `property: scale; from:0 0 0; to:1 1 1; dur:600; delay:${delay}; easing:easeOutElastic`);
}

// Confettis
function spawnConfettis() {
  for(let i=0;i<30;i++){
    const c = document.createElement('a-sphere');
    c.setAttribute('radius',0.03);
    c.setAttribute('color',`hsl(${Math.random()*360},100%,65%)`);
    c.setAttribute('position',`${(Math.random()-0.5)*2} 1 ${(Math.random()-0.5)*2}`);
    confettis.appendChild(c);

    let vy = Math.random()*0.02+0.01;
    function fall(){
      let pos = c.getAttribute('position');
      pos.y -= vy;
      if(pos.y > -1){ c.setAttribute('position',pos); requestAnimationFrame(fall); } 
      else c.remove();
    }
    fall();
  }
}

target.addEventListener('targetFound', () => {
  funPalmares.setAttribute('visible','false');
  videoPlane.setAttribute('visible','true');
  video.currentTime = 0;
  video.play();
});

video.addEventListener('ended', () => {
  videoPlane.setAttribute('visible','false');
  funPalmares.setAttribute('visible','true');

  // Pop des ic√¥nes en s√©quence
  animatePop(tennis, 0);
  animatePop(medal, 400);
  animatePop(trophy, 800);

  // Confettis apr√®s animations
  setTimeout(spawnConfettis, 1000);
});
</script>

</body>
</html>
