<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Serena Williams – Palmarès RA lisible</title>

<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

<style>
body {
  margin: 0;
  overflow: hidden;
  background: black;
  font-family: Arial, Helvetica, sans-serif;
}
</style>
</head>

<body>

<a-scene
  mindar-image="imageTargetSrc: serena.mind;"
  vr-mode-ui="enabled:false"
  device-orientation-permission-ui="enabled:true">

  <a-camera look-controls="false"></a-camera>

  <a-assets>
    <a-asset-item id="trophyModel" src="Trophy.glb"></a-asset-item>
    <a-asset-item id="medalModel" src="medal.glb"></a-asset-item>
    <a-asset-item id="ballModel" src="ball.glb"></a-asset-item>
    <video id="video-serena" src="serena.mp4" preload="auto" playsinline muted></video>
  </a-assets>

  <a-entity id="target" mindar-image-target="targetIndex:0">

    <!-- VIDEO -->
    <a-plane id="videoPlane"
      material="shader: flat; src: #video-serena"
      visible="false">
    </a-plane>

    <!-- PALMARES -->
    <a-entity id="palmares" visible="false">

      <!-- TROPHÉE -->
      <a-entity id="trophyGroup" position="0 0.6 0">
        <a-entity
          gltf-model="#trophyModel"
          scale="0 0 0"
          position="0 0 0"
          id="trophy">
        </a-entity>

        <a-text
          value="23 titres du Grand Chelem"
          position="0 -0.9 0.01"
          align="center"
          color="#ff4fd8"
          width="3.5"
          outline-color="#300018"
          outline-width="3">
        </a-text>
      </a-entity>

      <!-- MÉDAILLE -->
      <a-entity id="medalGroup" position="-2 0.3 0">
        <a-entity
          gltf-model="#medalModel"
          scale="0 0 0"
          position="0 0 0"
          id="medal">
        </a-entity>

        <a-text
          value="4 m&eacute;dailles d'or olympiques"
          position="0 -0.9 0.01"
          align="center"
          color="#ffd700"
          width="3.5"
          outline-color="#3a2a00"
          outline-width="3">
        </a-text>
      </a-entity>

      <!-- BALLE -->
      <a-entity id="ballGroup" position="2 0.3 0">
        <a-entity
          gltf-model="#ballModel"
          scale="0 0 0"
          position="0 0 0"
          id="ball">
        </a-entity>

        <a-text
          value="3 titres cons&eacute;cutifs &agrave; Roland-Garros"
          position="0 -0.9 0.01"
          align="center"
          color="#00ffd5"
          width="3.8"
          outline-color="#003830"
          outline-width="3">
        </a-text>
      </a-entity>

    </a-entity>

  </a-entity>
</a-scene>

<script>
const video = document.querySelector('#video-serena');
const videoPlane = document.querySelector('#videoPlane');
const palmares = document.querySelector('#palmares');
const target = document.querySelector('#target');

// Ajuste ratio vidéo
video.addEventListener('loadedmetadata', () => {
  const r = video.videoWidth / video.videoHeight;
  const h = 1.6;
  videoPlane.setAttribute(
    'geometry',
    `primitive: plane; width:${h*r}; height:${h}`
  );
});

// Animation propre
function showModel(id, scale, delay) {
  const el = document.querySelector(id);
  setTimeout(() => {
    el.setAttribute(
      'animation',
      `property: scale; from:0 0 0; to:${scale} ${scale} ${scale}; dur:600; easing:easeOutBack`
    );
  }, delay);
}

// Détection image
target.addEventListener('targetFound', () => {
  palmares.setAttribute('visible','false');
  videoPlane.setAttribute('visible','true');
  video.currentTime = 0;
  video.play();
});

// Fin vidéo
video.addEventListener('ended', () => {
  videoPlane.setAttribute('visible','false');
  palmares.setAttribute('visible','true');

  showModel('#trophy', 1.0, 0);
  showModel('#medal', 0.9, 1200);
  showModel('#ball', 0.9, 2400);
});
</script>

</body>
</html>
