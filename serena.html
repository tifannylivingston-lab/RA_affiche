<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Serena Williams â€“ RA</title>

  <!-- A-FRAME -->
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>

  <!-- MINDAR -->
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

  <style>
    body { margin: 0; overflow: hidden; }
    a-text { font-family: Arial; }
  </style>
</head>

<body>

<a-scene
  mindar-image="imageTargetSrc: serena.mind;"
  color-space="sRGB"
  renderer="colorManagement: true;"
  vr-mode-ui="enabled: false"
  device-orientation-permission-ui="enabled: true">

  <!-- CAMÃ‰RA -->
  <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

  <!-- ASSETS -->
  <a-assets>
    <!-- VIDÃ‰O : muted, playsinline, crossorigin pour MindAR -->
    <video id="video-serena" src="serena.mp4" preload="auto" muted playsinline crossorigin="anonymous"></video>
  </a-assets>

  <!-- CIBLE RA -->
  <a-entity mindar-image-target="targetIndex: 0" id="serenaTarget">

    <!-- VIDÃ‰O -->
    <a-video
      id="serenaVideo"
      src="#video-serena"
      width="1.2"
      height="0.7"
      position="0 0.4 0"
      loop
      muted
      playsinline>
    </a-video>

    <!-- TEXTE PALMARÃˆS -->
    <a-text
      value="ðŸŽ¾ Serena Williams\n\nðŸ† 23 Grands Chelems\nðŸ¥‡ 4 Or Olympiques\nðŸ‘‘ 319 semaines nÂ°1"
      position="0 -0.4 0"
      align="center"
      width="2"
      color="#ffffff">
    </a-text>

    <!-- MESSAGE INSPIRANT -->
    <a-text
      value="Â« Le talent nâ€™a pas de genre. Â»"
      position="0 -0.75 0"
      align="center"
      width="2"
      color="#FFD700">
    </a-text>

  </a-entity>

</a-scene>

<!-- SCRIPT pour forcer l'affichage de la vidÃ©o -->
<script>
  const target = document.querySelector("#serenaTarget");
  const video = document.querySelector("#video-serena");
  const aVideo = document.querySelector("#serenaVideo");

  target.addEventListener("targetFound", async () => {
    try {
      // Joue la vidÃ©o
      await video.play();

      // Force la mise Ã  jour de la texture WebGL
      aVideo.setAttribute('src', '#video-serena');
      if(aVideo.components.material && aVideo.components.material.material.map){
        aVideo.components.material.material.map.needsUpdate = true;
      }
    } catch(err){
      console.log("Autoplay bloquÃ©, clique pour lancer la vidÃ©o :", err);
      alert("Cliquez pour lancer la vidÃ©o !");
    }
  });

  target.addEventListener("targetLost", () => {
    video.pause();
  });
</script>

</body>
</html>
