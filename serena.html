<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Serena Williams â€“ RA (Neon Queen)</title>

<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

<style>
body {
  margin: 0;
  overflow: hidden;
  background: black;
  font-family: Arial, Helvetica, sans-serif;
}
.clickable { cursor: pointer; }
</style>
</head>

<body>

<a-scene
  mindar-image="imageTargetSrc: serena.mind;"
  vr-mode-ui="enabled:false"
  device-orientation-permission-ui="enabled:true">

  <a-camera look-controls="false"></a-camera>

  <a-assets>
    <video id="video-serena"
      src="serena.mp4"
      preload="auto"
      playsinline
      muted>
    </video>
  </a-assets>

  <a-entity id="target" mindar-image-target="targetIndex:0">

    <!-- VIDEO -->
    <a-plane id="videoPlane"
      material="shader: flat; src: #video-serena"
      visible="false">
    </a-plane>

    <!-- PALMARES -->
    <a-entity id="palmares" visible="false">

      <!-- CARTE NEON -->
      <a-plane id="card"
        width="3.4" height="2.2"
        material="shader: flat; color:#1a002e; opacity:0.95"
        scale="0 0 0">
      </a-plane>

      <!-- TITRE -->
      <a-text id="title"
        value="ðŸ‘‘ Serena Williams"
        position="0 0.8 0.04"
        align="center"
        width="3.5"
        color="#FF4FD8"
        opacity="0">
      </a-text>

      <!-- BADGES NEON -->
      <a-circle class="badge"
        radius="0.28"
        material="color:#9D00FF; emissive:#FF2EB3; emissiveIntensity:0.9"
        position="-1 0.2 0.05"
        scale="0 0 0"></a-circle>

      <a-circle class="badge"
        radius="0.28"
        material="color:#9D00FF; emissive:#FF2EB3; emissiveIntensity:0.9"
        position="0 0.2 0.05"
        scale="0 0 0"></a-circle>

      <a-circle class="badge"
        radius="0.28"
        material="color:#9D00FF; emissive:#FF2EB3; emissiveIntensity:0.9"
        position="1 0.2 0.05"
        scale="0 0 0"></a-circle>

      <!-- ICÃ”NES -->
      <a-text value="ðŸŽ¾" position="-1 0.2 0.08" align="center" width="2"></a-text>
      <a-text value="ðŸ¥‡" position="0 0.2 0.08" align="center" width="2"></a-text>
      <a-text value="ðŸ”¥" position="1 0.2 0.08" align="center" width="2"></a-text>

      <!-- DETAIL -->
      <a-text id="detail"
        position="0 -0.35 0.06"
        align="center"
        width="3.2"
        color="#FFFFFF"
        opacity="0">
      </a-text>

      <!-- QUIZ -->
      <a-entity id="quiz" visible="false" position="0 -0.9 0.05">
        <a-text value="ðŸŽ® Combien de titres du Grand Chelem ?"
          align="center"
          width="3"
          color="#FF4FD8">
        </a-text>

        <a-text value="18"
          position="-0.9 -0.35 0"
          width="2"
          color="#ffffff">
        </a-text>

        <a-text value="23 âœ…"
          position="0 -0.35 0"
          width="2"
          color="#00ffcc">
        </a-text>

        <a-text value="30"
          position="0.9 -0.35 0"
          width="2"
          color="#ffffff">
        </a-text>
      </a-entity>

      <!-- BOUTON -->
      <a-plane id="btnDetail"
        position="0 -0.15 0.07"
        width="1.5" height="0.45"
        material="color:#FF2EB3; emissive:#FF6FEA; emissiveIntensity:0.8"
        class="clickable"
        visible="false"
        opacity="0.95">
      </a-plane>

      <a-text id="btnText"
        value="âœ¨ Voir le palmarÃ¨s"
        position="0 -0.15 0.08"
        align="center"
        width="2.6"
        color="#1a002e"
        visible="false">
      </a-text>

      <!-- CONFETTIS -->
      <a-entity id="confettis"></a-entity>

    </a-entity>

  </a-entity>
</a-scene>

<script>
const video = document.querySelector('#video-serena');
const videoPlane = document.querySelector('#videoPlane');
const palmares = document.querySelector('#palmares');
const card = document.querySelector('#card');
const title = document.querySelector('#title');
const detail = document.querySelector('#detail');
const quiz = document.querySelector('#quiz');
const badges = document.querySelectorAll('.badge');
const confettis = document.querySelector('#confettis');
const btnDetail = document.querySelector('#btnDetail');
const btnText = document.querySelector('#btnText');
const target = document.querySelector('#target');

// Ajustement ratio vidÃ©o
video.addEventListener('loadedmetadata', () => {
  const r = video.videoWidth / video.videoHeight;
  const h = 1.6;
  videoPlane.setAttribute('geometry',
    `primitive: plane; width:${h*r}; height:${h}`);
});

// Image dÃ©tectÃ©e
target.addEventListener('targetFound', () => {
  palmares.setAttribute('visible','false');
  videoPlane.setAttribute('visible','true');
  video.currentTime = 0;
  video.play();
});

// Fin vidÃ©o
video.addEventListener('ended', () => {
  videoPlane.setAttribute('visible','false');
  palmares.setAttribute('visible','true');

  card.setAttribute('animation',
    'property: scale; from:0 0 0; to:1 1 1; dur:700; easing:easeOutBack');

  title.setAttribute('animation',
    'property: opacity; from:0; to:1; dur:600; delay:400');

  badges.forEach((b,i)=>{
    b.setAttribute('animation__pop',
      `property: scale; from:0 0 0; to:1 1 1;
       dur:600; delay:${800+i*250}; easing:easeOutElastic`);
  });

  // Confettis nÃ©on
  for(let i=0;i<35;i++){
    const c = document.createElement('a-sphere');
    c.setAttribute('radius',0.03);
    c.setAttribute('color',`hsl(${Math.random()*360},100%,65%)`);
    c.setAttribute('position',
      `${(Math.random()-0.5)*2} 1 ${(Math.random()-0.5)*2}`);
    confettis.appendChild(c);

    let vy = Math.random()*0.025+0.01;
    function fall(){
      let pos = c.getAttribute('position');
      pos.y -= vy;
      if(pos.y > -1){
        c.setAttribute('position', pos);
        requestAnimationFrame(fall);
      } else c.remove();
    }
    fall();
  }

  btnDetail.setAttribute('visible','true');
  btnText.setAttribute('visible','true');
});

// Bouton dÃ©tail
btnDetail.addEventListener('click', ()=>{
  detail.setAttribute('value',
    "ðŸŽ¾ 23 titres du Grand Chelem\nðŸ¥‡ 4 mÃ©dailles dâ€™or olympiques\nðŸ‘‘ 319 semaines nÂ°1 mondiale");

  detail.setAttribute('animation',
    'property: opacity; from:0; to:1; dur:400');

  quiz.setAttribute('visible','true');
  btnDetail.setAttribute('visible','false');
  btnText.setAttribute('visible','false');
});
</script>

</body>
</html>
