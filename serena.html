<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Serena Williams â€“ RA</title>

<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

<style>
body { margin:0; overflow:hidden; background:black; }
</style>
</head>

<body>

<a-scene
  mindar-image="imageTargetSrc: serena.mind;"
  vr-mode-ui="enabled:false"
  device-orientation-permission-ui="enabled:true">

<a-camera look-controls="false"></a-camera>

<a-assets>
  <video id="video-serena" src="serena.mp4" preload="auto" playsinline></video>
</a-assets>

<a-entity id="target" mindar-image-target="targetIndex:0">

  <!-- VIDEO -->
  <a-plane id="videoPlane"
    material="shader: flat; src: #video-serena"
    visible="false">
  </a-plane>

  <!-- PALMARES -->
  <a-entity id="palmares" visible="false">

    <!-- CARTE -->
    <a-plane id="card"
      width="3.2" height="2"
      color="#1c1c1c"
      opacity="0.95"
      scale="0 0 0">
    </a-plane>

    <!-- TITRE -->
    <a-text value="ðŸ† Serena Williams"
      position="0 0.7 0.02"
      align="center"
      width="3"
      color="#FFD700"
      opacity="0"
      id="title">
    </a-text>

    <!-- BADGES -->
    <a-entity id="badges">

      <a-circle class="badge" id="b1"
        radius="0.23" color="#FFD700"
        position="-0.9 0.1 0.03"
        scale="0 0 0"></a-circle>

      <a-circle class="badge" id="b2"
        radius="0.23" color="#FFD700"
        position="0 0.1 0.03"
        scale="0 0 0"></a-circle>

      <a-circle class="badge" id="b3"
        radius="0.23" color="#FFD700"
        position="0.9 0.1 0.03"
        scale="0 0 0"></a-circle>

    </a-entity>

    <!-- ICÃ”NES -->
    <a-text value="ðŸŽ¾" position="-0.9 0.1 0.05" align="center" width="1.5"></a-text>
    <a-text value="ðŸ¥‡" position="0 0.1 0.05" align="center" width="1.5"></a-text>
    <a-text value="ðŸ‘‘" position="0.9 0.1 0.05" align="center" width="1.5"></a-text>

    <!-- DETAIL -->
    <a-text id="detail"
      value=""
      position="0 -0.6 0.03"
      align="center"
      width="3"
      color="#FFFFFF"
      opacity="0">
    </a-text>

    <!-- QUIZ -->
    <a-entity id="quiz" visible="false" position="0 -0.8 0.03">

      <a-text value="ðŸŽ® Quiz : Combien de titres du Grand Chelem ?"
        align="center" width="3" color="#FFD700"></a-text>

      <a-text class="answer" value="18" position="-0.8 -0.3 0"
        color="#fff" width="2"></a-text>

      <a-text class="answer" value="23 âœ…" position="0 -0.3 0"
        color="#00ff99" width="2"></a-text>

      <a-text class="answer" value="30" position="0.8 -0.3 0"
        color="#fff" width="2"></a-text>

    </a-entity>

  </a-entity>
</a-entity>
</a-scene>

<script>
const video = document.querySelector('#video-serena');
const videoPlane = document.querySelector('#videoPlane');
const palmares = document.querySelector('#palmares');
const card = document.querySelector('#card');
const title = document.querySelector('#title');
const detail = document.querySelector('#detail');
const quiz = document.querySelector('#quiz');
const badges = document.querySelectorAll('.badge');
const target = document.querySelector('#target');

// Ratio vidÃ©o
video.addEventListener('loadedmetadata', () => {
  const r = video.videoWidth / video.videoHeight;
  const h = 1.6;
  videoPlane.setAttribute('geometry', `primitive: plane; width:${h*r}; height:${h}`);
});

// Scan
target.addEventListener('targetFound', () => {
  palmares.setAttribute('visible', 'false');
  videoPlane.setAttribute('visible', 'true');
  video.currentTime = 0;
  video.play();
});

// Fin vidÃ©o
video.addEventListener('ended', () => {
  videoPlane.setAttribute('visible', 'false');
  palmares.setAttribute('visible', 'true');

  card.setAttribute('animation',
    'property: scale; from:0 0 0; to:1 1 1; dur:700; easing:easeOutBack');

  title.setAttribute('animation',
    'property: opacity; from:0; to:1; dur:600; delay:400');

  badges.forEach((b,i)=>{
    b.setAttribute('animation__pop',
      `property: scale; from:0 0 0; to:1 1 1;
       dur:600; delay:${800+i*300}; easing:easeOutElastic`);

    b.setAttribute('animation__float',
      'property: position; dir:alternate; dur:3000; loop:true; easing:easeInOutSine; to: 0 '+(0.15+i*0.02)+' 0.03');
  });
});

// Interaction badges
document.querySelector('#b1').addEventListener('click',()=>{
  showDetail("ðŸŽ¾ 23 titres du Grand Chelem");
});
document.querySelector('#b2').addEventListener('click',()=>{
  showDetail("ðŸ¥‡ 4 mÃ©dailles dâ€™or olympiques");
});
document.querySelector('#b3').addEventListener('click',()=>{
  showDetail("ðŸ‘‘ 319 semaines nÂ°1 mondiale");
});

function showDetail(text){
  detail.setAttribute('value', text);
  detail.setAttribute('animation',
    'property: opacity; from:0; to:1; dur:400');
  quiz.setAttribute('visible','true');
}
</script>

</body>
</html>
