<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Serena Williams â€“ RA (Collector Cards)</title>

<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

<style>
body {
  margin: 0;
  overflow: hidden;
  background: black;
  font-family: Arial, Helvetica, sans-serif;
}
</style>
</head>

<body>

<a-scene
  mindar-image="imageTargetSrc: serena.mind;"
  vr-mode-ui="enabled:false"
  device-orientation-permission-ui="enabled:true">

  <a-camera look-controls="false"></a-camera>

  <a-assets>
    <video id="video-serena"
      src="serena.mp4"
      preload="auto"
      playsinline
      muted>
    </video>
  </a-assets>

  <a-entity id="target" mindar-image-target="targetIndex:0">

    <!-- VIDEO -->
    <a-plane id="videoPlane"
      material="shader: flat; src: #video-serena"
      visible="false">
    </a-plane>

    <!-- CARTES COLLECTOR -->
    <a-entity id="cards" visible="false">

      <!-- CARTE 1 -->
      <a-entity class="card" position="-1 0 0" rotation="0 15 0" scale="0 0 0">
        <a-plane width="0.9" height="1.3"
          material="shader: flat; color:#1a002e; opacity:0.25">
        </a-plane>

        <a-plane width="0.95" height="1.35"
          material="shader: flat; color:#FF2EB3; opacity:0.6"
          position="0 0 -0.01">
        </a-plane>

        <a-text value="ðŸŽ¾" position="0 0.4 0.02" align="center" width="2"></a-text>
        <a-text value="23" position="0 0.05 0.02" align="center"
          width="3" color="#ffffff"></a-text>
        <a-text value="GRAND CHELEM"
          position="0 -0.45 0.02" align="center"
          width="2" color="#FF4FD8"></a-text>
      </a-entity>

      <!-- CARTE 2 -->
      <a-entity class="card" position="0 0 0" scale="0 0 0">
        <a-plane width="0.9" height="1.3"
          material="shader: flat; color:#1a002e; opacity:0.25">
        </a-plane>

        <a-plane width="0.95" height="1.35"
          material="shader: flat; color:#9D00FF; opacity:0.6"
          position="0 0 -0.01">
        </a-plane>

        <a-text value="ðŸ¥‡" position="0 0.4 0.02" align="center" width="2"></a-text>
        <a-text value="4" position="0 0.05 0.02" align="center"
          width="3" color="#ffffff"></a-text>
        <a-text value="OR OLYMPIQUE"
          position="0 -0.45 0.02" align="center"
          width="2" color="#FF4FD8"></a-text>
      </a-entity>

      <!-- CARTE 3 -->
      <a-entity class="card" position="1 0 0" rotation="0 -15 0" scale="0 0 0">
        <a-plane width="0.9" height="1.3"
          material="shader: flat; color:#1a002e; opacity:0.25">
        </a-plane>

        <a-plane width="0.95" height="1.35"
          material="shader: flat; color:#FF6FEA; opacity:0.6"
          position="0 0 -0.01">
        </a-plane>

        <a-text value="ðŸ‘‘" position="0 0.4 0.02" align="center" width="2"></a-text>
        <a-text value="319" position="0 0.05 0.02" align="center"
          width="3" color="#ffffff"></a-text>
        <a-text value="SEM. NÂ°1"
          position="0 -0.45 0.02" align="center"
          width="2" color="#FF4FD8"></a-text>
      </a-entity>

    </a-entity>
  </a-entity>
</a-scene>

<script>
const video = document.querySelector('#video-serena');
const videoPlane = document.querySelector('#videoPlane');
const cards = document.querySelector('#cards');
const cardEls = document.querySelectorAll('.card');
const target = document.querySelector('#target');

// Ajustement ratio vidÃ©o
video.addEventListener('loadedmetadata', () => {
  const r = video.videoWidth / video.videoHeight;
  const h = 1.6;
  videoPlane.setAttribute(
    'geometry',
    `primitive: plane; width:${h*r}; height:${h}`
  );
});

// DÃ©tection image
target.addEventListener('targetFound', () => {
  cards.setAttribute('visible','false');
  videoPlane.setAttribute('visible','true');
  video.currentTime = 0;
  video.play();
});

// Fin vidÃ©o â†’ cartes
video.addEventListener('ended', () => {
  videoPlane.setAttribute('visible','false');
  cards.setAttribute('visible','true');

  cardEls.forEach((card, i) => {
    card.setAttribute('animation__flip',
      `property: rotation; from:0 90 0; to:${card.getAttribute('rotation').x} ${card.getAttribute('rotation').y} ${card.getAttribute('rotation').z};
       dur:600; delay:${i*300}; easing:easeOutBack`);

    card.setAttribute('animation__scale',
      `property: scale; from:0 0 0; to:1 1 1;
       dur:600; delay:${i*300}; easing:easeOutBack`);
  });
});
</script>

</body>
</html>
