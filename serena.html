<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Serena Williams â€“ RA (Animated Counters)</title>

<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

<style>
body {
  margin: 0;
  overflow: hidden;
  background: black;
  font-family: Arial, Helvetica, sans-serif;
}
</style>
</head>

<body>

<a-scene
  mindar-image="imageTargetSrc: serena.mind;"
  vr-mode-ui="enabled:false"
  device-orientation-permission-ui="enabled:true">

  <a-camera look-controls="false"></a-camera>

  <a-assets>
    <video id="video-serena"
      src="serena.mp4"
      preload="auto"
      playsinline
      muted>
    </video>
  </a-assets>

  <a-entity id="target" mindar-image-target="targetIndex:0">

    <!-- VIDEO -->
    <a-plane id="videoPlane"
      material="shader: flat; src: #video-serena"
      visible="false">
    </a-plane>

    <!-- COMPTEURS -->
    <a-entity id="counters" visible="false">

      <!-- TITRE -->
      <a-text value="ðŸ‘‘ SERENA WILLIAMS"
        position="0 0.7 0.05"
        align="center"
        width="4"
        color="#FF4FD8">
      </a-text>

      <!-- COUNTER 1 -->
      <a-entity position="-1 0 0">
        <a-text value="ðŸŽ¾"
          position="0 0.25 0.05"
          align="center"
          width="2.5">
        </a-text>

        <a-text id="count-gc"
          value="0"
          position="0 -0.05 0.05"
          align="center"
          width="3.5"
          color="#FFFFFF">
        </a-text>

        <a-text value="GRAND CHELEM"
          position="0 -0.45 0.05"
          align="center"
          width="2"
          color="#FF6FEA">
        </a-text>
      </a-entity>

      <!-- COUNTER 2 -->
      <a-entity position="0 0 0">
        <a-text value="ðŸ¥‡"
          position="0 0.25 0.05"
          align="center"
          width="2.5">
        </a-text>

        <a-text id="count-olympic"
          value="0"
          position="0 -0.05 0.05"
          align="center"
          width="3.5"
          color="#FFFFFF">
        </a-text>

        <a-text value="OR OLYMPIQUE"
          position="0 -0.45 0.05"
          align="center"
          width="2"
          color="#FF6FEA">
        </a-text>
      </a-entity>

      <!-- COUNTER 3 -->
      <a-entity position="1 0 0">
        <a-text value="ðŸ‘‘"
          position="0 0.25 0.05"
          align="center"
          width="2.5">
        </a-text>

        <a-text id="count-weeks"
          value="0"
          position="0 -0.05 0.05"
          align="center"
          width="3.5"
          color="#FFFFFF">
        </a-text>

        <a-text value="SEM. NÂ°1"
          position="0 -0.45 0.05"
          align="center"
          width="2"
          color="#FF6FEA">
        </a-text>
      </a-entity>

    </a-entity>

  </a-entity>
</a-scene>

<script>
const video = document.querySelector('#video-serena');
const videoPlane = document.querySelector('#videoPlane');
const counters = document.querySelector('#counters');
const target = document.querySelector('#target');

const countGC = document.querySelector('#count-gc');
const countOlympic = document.querySelector('#count-olympic');
const countWeeks = document.querySelector('#count-weeks');

// Ajuster le ratio vidÃ©o
video.addEventListener('loadedmetadata', () => {
  const r = video.videoWidth / video.videoHeight;
  const h = 1.6;
  videoPlane.setAttribute(
    'geometry',
    `primitive: plane; width:${h*r}; height:${h}`
  );
});

// Animation compteur
function animateCounter(el, end, duration) {
  let start = 0;
  const stepTime = Math.max(Math.floor(duration / end), 30);
  const increment = end / (duration / stepTime);

  const timer = setInterval(() => {
    start += increment;
    if (start >= end) {
      start = end;
      clearInterval(timer);
    }
    el.setAttribute('value', Math.floor(start));
  }, stepTime);
}

// Image dÃ©tectÃ©e
target.addEventListener('targetFound', () => {
  counters.setAttribute('visible','false');
  videoPlane.setAttribute('visible','true');
  video.currentTime = 0;
  video.play();
});

// Fin vidÃ©o â†’ compteurs
video.addEventListener('ended', () => {
  videoPlane.setAttribute('visible','false');
  counters.setAttribute('visible','true');

  // Apparition douce
  counters.setAttribute('animation',
    'property: scale; from:0.8 0.8 0.8; to:1 1 1; dur:500; easing:easeOutBack');

  // Lancement des compteurs (sÃ©quencÃ©s)
  setTimeout(() => animateCounter(countGC, 23, 900), 200);
  setTimeout(() => animateCounter(countOlympic, 4, 600), 800);
  setTimeout(() => animateCounter(countWeeks, 319, 1200), 1200);
});
</script>

</body>
</html>
